
{% extends 'theme/base.html' %}
{% load static cotton %}

{% block content %}
<div class="w-full px-4 py-8">

  <!-- Header -->
  <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
    <div class="text-center md:text-left flex-1">
      <h1 class="text-4xl font-bold mb-2">Antique Collection</h1>
      <p class="text-gray-500">Discover timeless treasures from our curated collection</p>
    </div>
  </div>

  {% if user.seller.is_verified %} 
  <a href="{% url 'antiques:antique-create' %}" class="btn btn-neutral mb-6">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
    Add New Antique
  </a>
  {% endif %}
  <!-- Filters -->
  <div class="card bg-base-100 shadow mb-8 p-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Search -->
      <div class="form-control w-full">
        <label class="label"><span class="label-text">Search</span></label>
        <input type="text" placeholder="Search antiques..." class="input input-bordered w-full"
               id="searchInput" value="{{ request.GET.search|default:'' }}">
      </div>

      <!-- Type -->
      <div class="form-control w-full">
        <label class="label"><span class="label-text">Type</span></label>
        <select id="typeFilter" class="select select-bordered w-full">
          <option value="">All Types</option>
          {% for type in antique_types %}
            <option value="{{ type }}" {% if request.GET.type == type %}selected{% endif %}>
              {{ type }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Show Sold -->
      <div class="form-control flex items-center justify-start mt-4 md:mt-0">
        <label class="cursor-pointer label flex items-center gap-2">
          <input type="checkbox" class="toggle toggle-primary" id="showSoldToggle"
                 {% if request.GET.show_sold == 'true' %}checked{% endif %}>
          <span class="label-text">Show Sold Items</span>
        </label>
      </div>
    </div>
    <div class="divider"></div>
    <p class="text-sm text-gray-500">
      Showing <span class="font-semibold text-gray-900">{{ object_list|length }}</span> antique{{ object_list|length|pluralize }}
    </p>
  </div>

  <!-- Antiques Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {% for antique in object_list %}
    <c-item-card
      image_url="{% if antique.images.exists %}{{ antique.images.first.image.url }}{% endif %}"
      title="{{ antique.title }}"
      detail_url="{{ antique.get_absolute_url }}"
      show_badges="False"
      show_metadata="False"
    >
      <c-slot name="placeholder_icon">
        <svg class="w-16 h-16 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
        </svg>
      </c-slot>

      <c-slot name="description">
        <p class="text-sm text-gray-600 line-clamp-3 mb-2">
          {{ antique.description|default:"No description available." }}
        </p>
        <div class="flex items-center gap-2 text-sm text-gray-500">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
          </svg>
          {{ antique.type_of_antique }}
        </div>
      </c-slot>

      <c-slot name="footer">
        <span class="font-bold text-lg">${{ antique.price }}</span>
        <button class="btn btn-sm"
                onclick="event.stopPropagation(); window.location.href='{{ antique.get_absolute_url }}'">
          View
        </button>
      </c-slot>
    </c-item-card>
    {% empty %}
    <div class="col-span-full">
      <div class="alert alert-info flex items-center gap-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span>No antiques found matching your criteria.</span>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<script type="module" src="{% static 'js/antiqueFilter.js' %}"></script>
{% endblock %}
